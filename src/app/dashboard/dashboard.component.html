<div class="min-h-screen bg-gray-100 dark:bg-gray-900 p-8 text-gray-900 dark:text-gray-100">
  @if (dashboardSummary$ | async; as summary) {
    <div class="max-w-7xl mx-auto">
      <div class="flex flex-col md:flex-row items-center justify-between mb-8">
        <h1 class="text-3xl md:text-4xl font-extrabold mb-4 md:mb-0">Dashboard</h1>

        <!-- Month and Year Selector -->
        <div class="flex items-center space-x-4">
          <button (click)="changeMonth('prev')"
                  class="py-1 px-3 rounded-lg text-sm font-bold text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">
            &lt;
          </button>
          <select [(ngModel)]="selectedMonthName" (change)="onMonthChange()"
                  class="py-1 px-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700">
            @for (month of monthNames; track month) {
              <option [value]="month">{{ month }}</option>
            }
          </select>
          <select [(ngModel)]="selectedYear" (change)="onMonthChange()"
                  class="py-1 px-2 rounded-lg text-sm font-medium bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700">
            @for (year of [2024, 2025, 2026]; track year) {
              <option [value]="year">{{ year }}</option>
            }
          </select>
          <button (click)="changeMonth('next')"
                  class="py-1 px-3 rounded-lg text-sm font-bold text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">
            &gt;
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Total Income</h2>
          <p class="text-3xl font-bold text-green-600 dark:text-green-400">₪{{ summary.total_income | number:'1.2-2' }}</p>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Total Expenses</h2>
          <p class="text-3xl font-bold text-red-600 dark:text-red-400">₪{{ summary.total_expenses | number:'1.2-2' }}</p>
        </div>
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Net Balance</h2>
          <p class="text-3xl font-bold">₪{{ summary.net_balance | number:'1.2-2' }}</p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg mb-10 border border-gray-200 dark:border-gray-700">
        <h2 class="text-xl md:text-2xl font-semibold mb-6">Monthly Expenses: Budget vs. Actual</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Sub-Category
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Budgeted
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Actual
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Difference
              </th>
            </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              @for (expense of summary.monthly_expenses; track expense.sub_category) {
                <tr [class.text-red-600]="isOverBudget(expense)">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">{{ expense.sub_category }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">₪{{ expense.budgeted_amount | number:'1.2-2' }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">{{ expense.actual_spent | number:'1.2-2' }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">{{ expense.difference | number:'1.2-2' }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
        <h2 class="text-xl md:text-2xl font-semibold mb-6">Savings Balances</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Savings Sub-Category
              </th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                Current Balance
              </th>
            </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              @for (balance of summary.savings_balances; track balance.sub_category) {
                <tr [class.text-red-600]="isNegativeBalance(balance)">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">{{ balance.sub_category }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">₪{{ balance.current_balance | number:'1.2-2' }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }
</div>
