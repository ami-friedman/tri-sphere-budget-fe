<div class="min-h-screen bg-gray-900 p-4 md:p-8 text-gray-100">
  <div class="max-w-7xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-center mb-8">
      <h1 class="text-3xl md:text-4xl font-extrabold mb-4 md:mb-0">Checking Transactions</h1>
      <div class="flex items-center space-x-2 bg-gray-800 px-2 py-1 rounded-lg">
        <button (click)="changeMonth('prev')" class="p-2 rounded-md hover:bg-gray-700 text-gray-400">&lt;</button>
        <select [(ngModel)]="selectedMonthName" (change)="onMonthChange()" class="font-semibold bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
          @for (month of monthNames; track month) { <option [value]="month">{{ month }}</option> }
        </select>
        <select [(ngModel)]="selectedYear" (change)="onMonthChange()" class="font-semibold bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
          @for (year of availableYears; track year) { <option [value]="year">{{ year }}</option> }
        </select>
        <button (click)="changeMonth('next')" class="p-2 rounded-md hover:bg-gray-700 text-gray-400">&gt;</button>
      </div>
    </div>

    <div class="bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg mb-10">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <h2 class="text-xl md:text-2xl font-semibold mb-4 md:mb-0">{{ editingTransactionId ? 'Edit' : 'Add New' }} Transaction</h2>
        <button (click)="onFundSavings()" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm">
          Fund Savings from Budget
        </button>
      </div>
      <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
        <div class="md:col-span-2">
          <label class="block mb-2 text-sm font-medium">Category</label>
          <select formControlName="category_id" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600">
            <option [ngValue]="null" disabled>Select a Category</option>
            @for(cat of filteredCategoriesForForm; track cat.id) {
              <option [value]="cat.id">{{ cat.name }}</option>
            }
          </select>
        </div>
        <div>
          <label class="block mb-2 text-sm font-medium">Amount (â‚ª)</label>
          <input type="number" formControlName="amount" class="w-full py-2 px-3 rounded-lg bg-gray-700 border border-gray-600">
        </div>
        <div class="flex items-end space-x-2">
          <button type="submit" [disabled]="transactionForm.invalid" class="w-full py-2 px-4 rounded-lg font-bold text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500">
            {{ editingTransactionId ? 'Update' : 'Add' }}
          </button>
          @if (editingTransactionId) {
            <button type="button" (click)="cancelEdit()" class="py-2 px-4 rounded-lg font-bold bg-gray-600 hover:bg-gray-500">
              Cancel
            </button>
          }
        </div>
      </form>
    </div>

    <div class="mb-6 border-b border-gray-700">
      <ul class="flex flex-wrap -mb-px font-medium text-center text-sm">
        <li class="mr-2"><button (click)="setActiveTab('income')" [ngClass]="{'border-b-2 border-blue-500 text-blue-400': (activeTab$ | async) === 'income'}" class="inline-block p-3 rounded-t-lg font-semibold border-transparent hover:text-gray-300">Income</button></li>
        <li class="mr-2"><button (click)="setActiveTab('cash')" [ngClass]="{'border-b-2 border-blue-500 text-blue-400': (activeTab$ | async) === 'cash'}" class="inline-block p-3 rounded-t-lg font-semibold border-transparent hover:text-gray-300">Cash</button></li>
        <li class="mr-2"><button (click)="setActiveTab('monthly')" [ngClass]="{'border-b-2 border-blue-500 text-blue-400': (activeTab$ | async) === 'monthly'}" class="inline-block p-3 rounded-t-lg font-semibold border-transparent hover:text-gray-300">Monthly</button></li>
        <li class="mr-2"><button (click)="setActiveTab('savings')" [ngClass]="{'border-b-2 border-blue-500 text-blue-400': (activeTab$ | async) === 'savings'}" class="inline-block p-3 rounded-t-lg font-semibold border-transparent hover:text-gray-300">Savings</button></li>
      </ul>
    </div>

    <div class="overflow-x-auto">
      <ag-grid-angular
        style="width: 100%; min-width: 800px;"
        class="ag-theme-alpine-dark"
        [rowData]="transactions$ | async"
        [columnDefs]="colDefs"
        [gridOptions]="gridOptions"
        [domLayout]="'autoHeight'"
        [suppressCellFocus]="true"
      >
      </ag-grid-angular>
    </div>
  </div>
</div>
